# 1337 Malware
We received a plea for help from a rather frustrated looking employee. He said he accidently ran malware on his computer, but when he tried to pay the "leet hacker" to get his files back they said the malware was "broken"... best IT could do was provide us a PCAP.

# Flag
flag{c95c4ff18b0eb88123de779051a7a24f}

# Solution
In the PCAP file, we can see a python script being retrieved over HTTP. See `rans.py`.

We can also see the following files being sent:
```
Sending: /home/davey/Documents/resources.zip
Sending: /home/davey/Documents/ecorp.png
Sending: /home/davey/Documents/Welcome Aboard.pdf
Sending: /home/davey/Documents/.ssh/id_rsa
Sending: /home/davey/Documents/.ssh/id_rsa.pub
```

From `rans.py`, we can tell that the files are XORed with a 32-byte key to be encrypted.

```python
# DON'T FORGET TO CHANGE THIS TO THE REAL KEY!!!!
key = randbytes(32)

def encrypt(filename):
    f = open(filename, 'rb')
    data = f.read()
    f.close()
   
    encrypted = xor(data, key)
    return encrypted
```

One of the files encrypted is an SSH Private Key. Trying different starting plaintexts for the private key, we find that getting the key by XORing the first 32 bytes of `-----BEGIN OPENSSH PRIVATE KEY-----\n` with the first 32 bytes of the encrypted file, then using that key to decrypt the other files works.

See `xor.py`. 

```
xor_key:  b'\x82\xc2SP\x8b\xd5LG\xa7\xe5m\xec\xd8v\xb5\xd6\xa4\'\xc6E\t\x0br\xe1\xb9q3"\xfe\xe1YY'

Decrypted id_rsa file:
b'-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----\n'
```

Decrypting `Welcome Aboard.pdf` shows us a letter:
```
Subject: Welcome to E-Corp - New User Information
Dear Diego Perez,
Welcome to E-Corp! We are thrilled to have you as part of our team. 

...

Your unique password to access this zip
file is: ecorp2024newuser!!

...

Best regards,
Brianna Johnson
E-Corp Head of Human
```

Use `ecorp2024newuser!!` as a password to unzip `resources.zip` and get the flag file.